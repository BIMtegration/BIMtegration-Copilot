{
  "ExportDate": "2025-10-20T13:58:34.2320079-05:00",
  "Version": "1.0",
  "TotalScripts": 3,
  "ExportType": "Selective",
  "Scripts": [
    {
      "Id": "budget-db-extraktion-&-upload-6642051373",
      "Name": "Budget DB Extraktion & Upload",
      "Description": "Lädt die Budgetdatenbank, verarbeitet Revit-Elemente, exportiert als CSV und lädt die Ergebnisse automatisch nach Google Sheets hoch.",
      "Category": "🌐 HTTP Examples",
      "Icon": "script.png",
      "Code": "// 🚀 Escribe tu código C# aquí\nusing System;\nusing System.Collections.Generic;\nusing System.Globalization;\nusing System.IO;\nusing System.Linq;\nusing System.Net.Http;\nusing System.Text;\nusing System.Text.RegularExpressions;\nusing System.Threading.Tasks;\nusing Newtonsoft.Json;\nusing Autodesk.Revit.DB;\nusing Autodesk.Revit.UI;\n\ntry\n{\n    // Configuración\n    const string URL = \"https://script.google.com/macros/s/AKfycbx8asivIkpIZcTmbyuPFbcitKi6h8YjbfQP9q0P0I8qnJpdtfQ4WIQnGdXPN6KH0S8pHg/exec\";\n    const string TOKEN = \"Ii71jBhY34DAxNSwmGUzoOFK0CktZPny5sW9cTVvRuMHqdfp\";\n    const string SHEET_ID = \"1j02RBg7BdZQAgOhPXM0rRHRI_BNohZuzBDNTYlKZHy4\";\n    const string SHEET_NAME = \"Extraktion\";\n\n    string nombreArchivo = doc.Title;\n    string fechaHora = DateTime.Now.ToString(\"yyyy-MM-dd HH:mm:ss\");\n    string timestamp = fechaHora.Replace(\" \", \"_\").Replace(\":\", \"-\");\n\n    // 1. Descargar BDB\n    TaskDialog.Show(\"Budget DB\", \"📥 Descargando datos de Budget DB...\");\n    string urlBdb = $\"{URL}?token={TOKEN}&sheetId={SHEET_ID}&sheetName=BDB\";\n    var bdbData = await GetJsonArray(urlBdb);\n\n    // 2. Construir diccionario por Schlüssel\n    var bdbDict = new Dictionary<string, Dictionary<string, object>>(StringComparer.OrdinalIgnoreCase);\n    foreach (var item in bdbData)\n    {\n        if (item.TryGetValue(\"Schlüssel\", out var kobj) && kobj != null)\n        {\n            var key = kobj.ToString();\n            if (!string.IsNullOrEmpty(key) && !bdbDict.ContainsKey(key))\n                bdbDict[key] = item;\n        }\n    }\n\n    // 3. Recopilar elementos de Revit\n    var collector = new FilteredElementCollector(doc).WhereElementIsNotElementType();\n    var elems = collector.ToElements();\n\n    var fieldnames = new[] { \"Datum\",\"Schlüssel\",\"Einheit\",\"Messen\",\"Preis\",\"Niveau\",\"Vollendet\",\"Objekt-ID\",\"Kategorie\",\"Proyecto\" };\n    var rows = new List<string[]>();\n    var rowsForSheets = new List<object[]>(); // Para Google Sheets, Preis como número\n    var missingKey = new List<string>();\n    var noEq = new List<string>();\n    var badEq = new List<string>();\n\n    int processed = 0;\n    foreach (Element e in elems)\n    {\n        Element type = doc.GetElement(e.GetTypeId());\n        if (type == null) continue;\n        var pars = type.GetParameters(\"Schlüssel\");\n        foreach (var p in pars)\n        {\n            string raw = p.AsString();\n            var keys = CleanSplitKeys(raw);\n            if (keys.Count == 0) continue;\n            foreach (var actividad in keys)\n            {\n                string elemId = e.Id.Value.ToString(CultureInfo.InvariantCulture);\n                if (!bdbDict.TryGetValue(actividad, out var entry))\n                {\n                    missingKey.Add(elemId);\n                    continue;\n                }\n                string categoria = e.Category != null ? e.Category.Name : \"Sin categoría\";\n                string einheit = GetValue(entry, \"Einheit\", \"M2\");\n                string preis = GetValue(entry, \"Preis\", \"$$\");\n                string gleichung = GetValue(entry, \"Gleichung\", \"\");\n                if (string.IsNullOrWhiteSpace(gleichung))\n                {\n                    noEq.Add(elemId);\n                    continue;\n                }\n                string level = null;\n                try\n                {\n                    if (e.LevelId != ElementId.InvalidElementId)\n                    {\n                        var lvl = doc.GetElement(e.LevelId) as Level;\n                        level = lvl != null ? lvl.Name : null;\n                    }\n                }\n                catch { }\n\n                string ejecutado = null;\n                try\n                {\n                    var pp = e.LookupParameter(\"Vollendet\");\n                    ejecutado = pp != null ? pp.AsValueString() : null;\n                }\n                catch { }\n\n                string messen = EvaluateGleichung(e, gleichung, doc);\n\n                if (messen == \"ERROR\" || messen == \"0\" || string.IsNullOrEmpty(messen))\n                {\n                    badEq.Add(elemId);\n                }\n\n                // Formato CSV (Preis como texto para Excel)\n                string formattedSchlussel = FormatAsExcelTextStrong(FormatSchlussel(actividad));\n                string formattedMessen = FormatAsExcelTextStrong(FormatDecimal(messen));\n                string formattedPreis = FormatAsExcelText(FormatDecimal(preis));\n                rows.Add(new[] { fechaHora, formattedSchlussel, einheit, formattedMessen, formattedPreis, level, ejecutado, elemId, categoria, nombreArchivo });\n\n                // Formato para Google Sheets (Preis como número)\n                double preisNumber = 0;\n                double.TryParse(FormatDecimal(preis), NumberStyles.Any, CultureInfo.InvariantCulture, out preisNumber);\n                rowsForSheets.Add(new object[] {\n                    fechaHora,\n                    FormatSchlussel(actividad),\n                    einheit,\n                    FormatDecimal(messen),\n                    preisNumber,\n                    level,\n                    ejecutado,\n                    elemId,\n                    categoria,\n                    nombreArchivo\n                });\n            }\n        }\n        processed++;\n        if (processed % 1000 == 0)\n            TaskDialog.Show(\"Progreso\", $\"📊 Procesados: {processed} elementos...\");\n    }\n\n    // 4. Guardar CSV\n    string rvtPath = doc.PathName;\n    string dir = string.IsNullOrEmpty(rvtPath) ? Environment.GetFolderPath(Environment.SpecialFolder.DesktopDirectory) : Path.GetDirectoryName(rvtPath);\n    string csv = Path.Combine(dir, $\"{doc.Title}_{timestamp}.csv\");\n    WriteCsv(csv, fieldnames, rows);\n    TaskDialog.Show(\"CSV Guardado\", $\"📄 Archivo CSV generado:\\n{csv}\");\n\n    // 5. Subir a Google Sheets (Preis como número)\n    string postRes = \"No data to upload\";\n    if (rowsForSheets.Count > 0)\n    {\n        var payload = new Dictionary<string, object>\n        {\n            { \"headers\", fieldnames },\n            { \"values\", rowsForSheets }\n        };\n        string postUrl = $\"{URL}?token={TOKEN}&sheetId={SHEET_ID}&sheetName={SHEET_NAME}\";\n        postRes = await PostJson(postUrl, payload);\n        TaskDialog.Show(\"Google Sheets\", \"✅ Datos subidos a Google Sheets\");\n    }\n\n    // 6. Resumen\n    string msg =\n        \"✅ Extracción BDB completada exitosamente\\n\\n\" +\n        $\"📄 Archivo CSV generado:\\n{csv}\\n\\n\" +\n        $\"📊 Elementos procesados: {rows.Count}\\n\" +\n        $\"📋 Datos BDB obtenidos: {bdbData.Count} registros\";\n\n    msg += \"\\n\\n📊 RESUMEN DETALLADO:\";\n    msg += $\"\\n✅ Elementos exitosos: {rows.Count - missingKey.Count - noEq.Count - badEq.Count}\";\n    msg += $\"\\n🔍 Sin datos BDB: {missingKey.Count}\";\n    msg += $\"\\n❌ Sin Gleichung: {noEq.Count}\";\n    msg += $\"\\n⚡ Error en Gleichung: {badEq.Count}\";\n\n    if (missingKey.Count > 0 || noEq.Count > 0 || badEq.Count > 0)\n    {\n        msg += \"\\n\\n⚠️ DETALLES DE ERRORES:\";\n        if (missingKey.Count > 0)\n            msg += $\"\\n🔍 Elementos sin datos BDB: {missingKey.Count}\\n   IDs: {JoinIds(missingKey, 10)}\";\n        if (noEq.Count > 0)\n            msg += $\"\\n❌ Elementos sin Gleichung: {noEq.Count}\\n   IDs: {JoinIds(noEq, 10)}\";\n        if (badEq.Count > 0)\n            msg += $\"\\n⚡ Elementos con error en Gleichung: {badEq.Count}\\n   IDs: {JoinIds(badEq, 10)}\";\n    }\n\n    TaskDialog.Show(\"Resumen\", msg);\n    return msg;\n}\ncatch (Exception ex)\n{\n    TaskDialog.Show(\"Error\", ex.Message);\n    return $\"❌ Error: {ex.Message}\";\n}\n\n// --- Utilidades idénticas al comando original ---\n\nList<Dictionary<string, object>> ParseJsonArray(string json)\n{\n    try\n    {\n        if (string.IsNullOrWhiteSpace(json)) return new List<Dictionary<string, object>>();\n        var cleanJson = json.Trim();\n        var wrapper = JsonConvert.DeserializeObject<Dictionary<string, object>>(cleanJson);\n        if (wrapper != null && wrapper.TryGetValue(\"data\", out var dataObj))\n        {\n            var dataJson = JsonConvert.SerializeObject(dataObj);\n            var dataList = JsonConvert.DeserializeObject<List<Dictionary<string, object>>>(dataJson);\n            return dataList ?? new List<Dictionary<string, object>>();\n        }\n        var list = JsonConvert.DeserializeObject<List<Dictionary<string, object>>>(cleanJson);\n        if (list != null) return list;\n        return new List<Dictionary<string, object>>();\n    }\n    catch { return new List<Dictionary<string, object>>(); }\n}\n\nasync Task<List<Dictionary<string, object>>> GetJsonArray(string url)\n{\n    using (var hc = new HttpClient())\n    {\n        hc.Timeout = TimeSpan.FromMinutes(5);\n        var s = await hc.GetStringAsync(url).ConfigureAwait(false);\n        return ParseJsonArray(s);\n    }\n}\n\nasync Task<string> PostJson(string url, object payload)\n{\n    using (var hc = new HttpClient())\n    {\n        hc.Timeout = TimeSpan.FromMinutes(5);\n        var json = JsonConvert.SerializeObject(payload);\n        var res = await hc.PostAsync(url, new StringContent(json, Encoding.UTF8, \"application/json\")).ConfigureAwait(false);\n        return await res.Content.ReadAsStringAsync().ConfigureAwait(false);\n    }\n}\n\nvoid WriteCsv(string path, string[] headers, List<string[]> rows)\n{\n    using (var fs = new FileStream(path, FileMode.Create, FileAccess.Write, FileShare.Read))\n    using (var sw = new StreamWriter(fs, new UTF8Encoding(true)))\n    {\n        sw.WriteLine(JoinCsv(headers));\n        foreach (var r in rows)\n            sw.WriteLine(JoinCsv(r));\n    }\n}\n\nstring JoinCsv(IEnumerable<string> cells) => string.Join(\";\", cells.Select(cell => cell ?? \"\"));\nstring JoinIds(List<string> ids, int max = 20) => (ids == null || ids.Count == 0) ? \"-\" : (ids.Count <= max ? string.Join(\", \", ids) : string.Join(\", \", ids.Take(max)) + $\" ... ({ids.Count} en total)\");\n\nList<string> CleanSplitKeys(string value)\n{\n    var result = new List<string>();\n    if (string.IsNullOrWhiteSpace(value)) return result;\n    var s = value.Replace(',', '.');\n    foreach (var raw in s.Split(';'))\n    {\n        var k = (raw ?? string.Empty).Trim();\n        if (string.IsNullOrEmpty(k)) continue;\n        k = k.Replace(\" \", \"\");\n        k = Regex.Replace(k, @\"\\.+\", \".\");\n        k = k.Trim('.');\n        if (Regex.IsMatch(k, \"^\\\\d+(?:\\\\.\\\\d+)*$\"))\n            result.Add(k);\n    }\n    return result;\n}\n\nstring GetValue(Dictionary<string, object> d, string key, string defVal)\n{\n    if (d.TryGetValue(key, out var v) && v != null)\n    {\n        if (v is double || v is float || v is decimal)\n            return Convert.ToDouble(v).ToString(\"0.###\", CultureInfo.InvariantCulture);\n        if (v is string str && double.TryParse(str, NumberStyles.Any, CultureInfo.InvariantCulture, out double numValue))\n            return numValue.ToString(\"0.###\", CultureInfo.InvariantCulture);\n        return v.ToString();\n    }\n    return defVal;\n}\n\nstring EvaluateGleichung(Element elem, string gleichung, Document doc)\n{\n    try\n    {\n        if (string.IsNullOrWhiteSpace(gleichung)) return \"ERROR\";\n        if (gleichung.Trim().Equals(\"COUNT\", StringComparison.OrdinalIgnoreCase)) return \"1\";\n        string expr = Regex.Replace(gleichung.Trim(), @\"\\bBuiltInParameter\\.\\b\", string.Empty);\n        var tokens = Regex.Matches(expr, @\"\\b[A-Z][A-Z0-9_]*\\b\").Cast<Match>().Select(m => m.Value).Distinct().OrderByDescending(s => s.Length).ToList();\n        var values = new Dictionary<string, double>(StringComparer.OrdinalIgnoreCase);\n        foreach (var token in tokens)\n        {\n            if (token == \"COUNT\") { values[token] = 1.0; continue; }\n            double v = 0.0;\n            Parameter p = null;\n            try { var bip = (BuiltInParameter)Enum.Parse(typeof(BuiltInParameter), token, ignoreCase: true); p = elem.get_Parameter(bip); } catch { }\n            if (p == null) { try { p = elem.LookupParameter(token); } catch { } }\n            if (p != null)\n            {\n                try\n                {\n                    if (p.StorageType == StorageType.Double)\n                        v = ConvertByToken(p.AsDouble(), token, doc);\n                    else if (p.StorageType == StorageType.Integer)\n                        v = p.AsInteger();\n                    else if (p.StorageType == StorageType.String)\n                        v = CleanAndSum(p.AsString());\n                    else\n                        v = CleanAndSum(p.AsValueString());\n                }\n                catch { v = 0.0; }\n            }\n            values[token] = v;\n        }\n        string exprNumeric = Regex.Replace(expr, @\"\\b[A-Z][A-Z0-9_]*\\b\", m => values.TryGetValue(m.Value, out var vv) ? vv.ToString(CultureInfo.InvariantCulture) : \"0\");\n        if (!Regex.IsMatch(exprNumeric, @\"^[\\d\\.\\+\\-\\*\\/\\(\\) \\t]+$\")) return \"ERROR\";\n        double result = SimpleCalc.Eval(exprNumeric);\n        return result.ToString(\"0.###\", CultureInfo.InvariantCulture);\n    }\n    catch { return \"ERROR\"; }\n}\n\ndouble ConvertByToken(double internalVal, string token, Document doc)\n{\n    try\n    {\n        if (token.Contains(\"AREA\"))\n            return UnitUtils.ConvertFromInternalUnits(internalVal, UnitTypeId.SquareMeters);\n        if (token.Contains(\"VOLUME\"))\n            return UnitUtils.ConvertFromInternalUnits(internalVal, UnitTypeId.CubicMeters);\n        if (new[] {\"LENGTH\",\"HEIGHT\",\"WIDTH\",\"THICKNESS\",\"RADIUS\",\"DIAMETER\",\"PERIMETER\",\"DEPTH\"}.Any(token.Contains))\n            return UnitUtils.ConvertFromInternalUnits(internalVal, UnitTypeId.Meters);\n    }\n    catch { }\n    return internalVal;\n}\n\ndouble CleanAndSum(string s)\n{\n    if (string.IsNullOrWhiteSpace(s)) return 0.0;\n    s = s.Replace(\",\", \".\");\n    var parts = s.Split(';');\n    double sum = 0.0;\n    foreach (var p in parts)\n    {\n        var t = p.Trim().Replace(\"m²\", string.Empty).Replace(\"m³\", string.Empty).Replace(\"m\", string.Empty);\n        if (double.TryParse(t, NumberStyles.Float, CultureInfo.InvariantCulture, out double v)) sum += v;\n    }\n    return sum;\n}\n\nstring FormatSchlussel(string schlussel)\n{\n    if (string.IsNullOrWhiteSpace(schlussel)) return schlussel;\n    string cleaned = schlussel.Replace(\".\", \"\");\n    if (cleaned.Length == 9 && cleaned.All(char.IsDigit))\n        return $\"{cleaned.Substring(0, 3)}.{cleaned.Substring(3, 3)}.{cleaned.Substring(6, 3)}\";\n    return schlussel;\n}\n\nstring FormatDecimal(string value)\n{\n    if (string.IsNullOrWhiteSpace(value)) return value;\n    if (double.TryParse(value, NumberStyles.Any, CultureInfo.InvariantCulture, out double number))\n        return number.ToString(\"0.###\", CultureInfo.InvariantCulture);\n    return value;\n}\n\nstring FormatAsExcelText(string value)\n{\n    if (string.IsNullOrWhiteSpace(value)) return \"\";\n    string escaped = value.Replace(\"\\\"\", \"\\\"\\\"\");\n    return $\"\\\"{escaped}\\\"\";\n}\n\nstring FormatAsExcelTextStrong(string value)\n{\n    if (string.IsNullOrWhiteSpace(value)) return \"\";\n    string escaped = value.Replace(\"\\\"\", \"\\\"\\\"\");\n    return $\"=\\\"{escaped}\\\"\";\n}\n\nstatic class SimpleCalc\n{\n    public static double Eval(string s)\n    {\n        var output = new Stack<double>();\n        var ops = new Stack<char>();\n        int i = 0;\n        while (i < s.Length)\n        {\n            char c = s[i];\n            if (char.IsWhiteSpace(c)) { i++; continue; }\n            if (char.IsDigit(c) || c == '.')\n            {\n                int j = i + 1;\n                while (j < s.Length && (char.IsDigit(s[j]) || s[j] == '.')) j++;\n                var num = double.Parse(s.Substring(i, j - i), CultureInfo.InvariantCulture);\n                output.Push(num); i = j; continue;\n            }\n            if (c == '(') { ops.Push(c); i++; continue; }\n            if (c == ')')\n            {\n                while (ops.Count > 0 && ops.Peek() != '(') Apply(ops.Pop(), output);\n                if (ops.Count == 0) throw new Exception(\"Paren mismatch\");\n                ops.Pop(); i++; continue;\n            }\n            if (IsOp(c))\n            {\n                while (ops.Count > 0 && IsOp(ops.Peek()) && Prec(ops.Peek()) >= Prec(c)) Apply(ops.Pop(), output);\n                ops.Push(c); i++; continue;\n            }\n            throw new Exception(\"Invalid char: \" + c);\n        }\n        while (ops.Count > 0) Apply(ops.Pop(), output);\n        return output.Pop();\n    }\n    static bool IsOp(char c) => c=='+'||c=='-'||c=='*'||c=='/';\n    static int Prec(char c) => (c=='+'||c=='-') ? 1 : 2;\n    static void Apply(char op, Stack<double> st)\n    {\n        var b = st.Pop(); var a = st.Pop();\n        if (op == '+') st.Push(a + b);\n        else if (op == '-') st.Push(a - b);\n        else if (op == '*') st.Push(a * b);\n        else if (op == '/') st.Push(a / b);\n    }\n}",
      "IsFavorite": false,
      "ShowAsButton": true,
      "CreatedDate": "2025-10-16T10:17:44.2049919-05:00",
      "LastModified": "2025-10-16T10:17:44.2049919-05:00"
    },
    {
      "Id": "filtere-nach-gültigem-schlüssel-1704463314",
      "Name": "Filtere nach gültigem Schlüssel",
      "Description": "Hebt Elemente im Modell farbig hervor, je nachdem ob sie einen gültigen, ungültigen oder keinen Schlüssel besitzen. Verwendet aktuelle BDB-Daten aus Google Sheets.",
      "Category": "🌐 HTTP Examples",
      "Icon": "script.png",
      "Code": "// 🚀 Escribe tu código C# aquí\nusing System.Net.Http;\nusing Autodesk.Revit.DB;\nusing Autodesk.Revit.UI;\nusing System.Collections.Generic;\nusing System.Linq;\nusing Newtonsoft.Json.Linq;\n\n// Parámetros de conexión\nconst string URL = \"https://script.google.com/macros/s/AKfycbx8asivIkpIZcTmbyuPFbcitKi6h8YjbfQP9q0P0I8qnJpdtfQ4WIQnGdXPN6KH0S8pHg/exec\";\nconst string TOKEN = \"Ii71jBhY34DAxNSwmGUzoOFK0CktZPny5sW9cTVvRuMHqdfp\";\nconst string SHEET_ID = \"1j02RBg7BdZQAgOhPXM0rRHRI_BNohZuzBDNTYlKZHy4\";\nconst string VIEW_NAME = \"ausstehende zu parametrisierende Elemente\";\n\n// Obtener datos BDB de Google Sheets\nstring urlBdb = $\"{URL}?token={TOKEN}&sheetId={SHEET_ID}&sheetName=BDB\";\nstring rawBdb;\nusing (var hc = new HttpClient())\n{\n    rawBdb = await hc.GetStringAsync(urlBdb);\n}\n\n// Deserializar correctamente el objeto y extraer la lista\nvar bdbObj = JObject.Parse(rawBdb);\nif ((string)bdbObj[\"status\"] != \"ok\")\n    return \"❌ Error al obtener datos: \" + (string)bdbObj[\"message\"];\nvar bdbData = bdbObj[\"data\"] as JArray;\nif (bdbData == null)\n    return \"❌ No se encontró la propiedad 'data' en la respuesta.\";\n\n// Construir diccionario de Schlüssel válidos\nvar validKeys = new HashSet<string>(\n    bdbData\n        .Where(item => item[\"Schlüssel\"] != null)\n        .Select(item => item[\"Schlüssel\"].ToString()),\n    System.StringComparer.OrdinalIgnoreCase);\n\n// Analizar elementos del modelo\nvar collector = new FilteredElementCollector(doc).WhereElementIsNotElementType();\nvar elementsWithoutSchlüssel = new List<ElementId>();\nvar elementsWithInvalidSchlüssel = new List<ElementId>();\nvar elementsValid = new List<ElementId>();\n\nforeach (Element e in collector)\n{\n    Element type = doc.GetElement(e.GetTypeId());\n    if (type == null) continue;\n\n    var pars = type.GetParameters(\"Schlüssel\");\n    bool hasValidSchlüssel = false;\n    bool hasAnySchlüssel = false;\n\n    foreach (var p in pars)\n    {\n        string raw = p.AsString();\n        var keys = string.IsNullOrWhiteSpace(raw)\n            ? new List<string>()\n            : raw.Replace(',', '.').Split(';').Select(k => k.Trim().Replace(\" \", \"\")).Where(k => !string.IsNullOrEmpty(k)).ToList();\n\n        if (keys.Count > 0)\n        {\n            hasAnySchlüssel = true;\n            foreach (var actividad in keys)\n            {\n                if (validKeys.Contains(actividad))\n                {\n                    hasValidSchlüssel = true;\n                    break;\n                }\n            }\n        }\n    }\n\n    if (!hasAnySchlüssel)\n        elementsWithoutSchlüssel.Add(e.Id);\n    else if (!hasValidSchlüssel)\n        elementsWithInvalidSchlüssel.Add(e.Id);\n    else\n        elementsValid.Add(e.Id);\n}\n\n// Buscar o crear la vista 3D\nView3D targetView = new FilteredElementCollector(doc)\n    .OfClass(typeof(View3D))\n    .Cast<View3D>()\n    .FirstOrDefault(v => !v.IsTemplate && v.Name.Equals(VIEW_NAME, System.StringComparison.OrdinalIgnoreCase));\n\nif (targetView == null)\n{\n    var viewFamilyType = new FilteredElementCollector(doc)\n        .OfClass(typeof(ViewFamilyType))\n        .Cast<ViewFamilyType>()\n        .FirstOrDefault(vft => vft.ViewFamily == ViewFamily.ThreeDimensional);\n    targetView = View3D.CreateIsometric(doc, viewFamilyType.Id);\n    targetView.Name = VIEW_NAME;\n}\n\n// Limpiar vista\nvar allElements = new FilteredElementCollector(doc, targetView.Id).ToElementIds();\ntargetView.UnhideElements(allElements);\n\n// Aplicar colores\nvoid ApplyColor(List<ElementId> ids, Autodesk.Revit.DB.Color color)\n{\n    var ogs = new OverrideGraphicSettings();\n    ogs.SetProjectionLineColor(color);\n    ogs.SetSurfaceForegroundPatternColor(color);\n    foreach (var id in ids)\n    {\n        try { targetView.SetElementOverrides(id, ogs); } catch { }\n    }\n}\nApplyColor(elementsWithoutSchlüssel, new Autodesk.Revit.DB.Color(255, 0, 0)); // Rojo\nApplyColor(elementsWithInvalidSchlüssel, new Autodesk.Revit.DB.Color(255, 255, 0)); // Amarillo\nApplyColor(elementsValid, new Autodesk.Revit.DB.Color(0, 255, 0)); // Verde\n\n// Activar la vista\nuidoc.ActiveView = targetView;\n\n// Mostrar resumen\nreturn $\"✅ Filtro aplicado\\n🔴 Sin Schlüssel: {elementsWithoutSchlüssel.Count}\\n🟡 Schlüssel inválido: {elementsWithInvalidSchlüssel.Count}\\n🟢 Schlüssel válido: {elementsValid.Count}\\nTotal BDB: {bdbData.Count}\";",
      "IsFavorite": false,
      "ShowAsButton": true,
      "CreatedDate": "2025-10-18T16:02:50.4461237-05:00",
      "LastModified": "2025-10-18T16:02:50.4461246-05:00"
    },
    {
      "Id": "elemente-nummerieren-6895599612",
      "Name": "Elemente nummerieren",
      "Description": "Nummeriert ausgewählte Elemente im Modell automatisch und zeigt den alten sowie neuen Wert des Parameters für jedes Element an. Ideal zur schnellen und transparenten Vergabe von Kennungen oder Markierungen.",
      "Category": "Modificación",
      "Icon": "script.png",
      "Code": "using Autodesk.Revit.DB;\r\nusing Autodesk.Revit.UI;\r\nusing Autodesk.Revit.UI.Selection;\r\nusing System;\r\nusing System.Collections.Generic;\r\nusing System.Linq;\r\nusing WF = System.Windows.Forms;\r\n\r\n// --- Hauptskript für Copilot ---\r\n// Handler-Reflexion\r\nvar handlerObj = (object)externalEventHandler;\r\nvar actionProp = handlerObj.GetType().GetProperty(\"ActionToExecute\");\r\nif (actionProp == null) throw new Exception(\"ActionToExecute wurde im Handler nicht gefunden.\");\r\n\r\n// Aktion definieren\r\nAction<UIApplication> aktion = (uiapp) =>\r\n{\r\n    var doc = uiapp?.ActiveUIDocument?.Document;\r\n    var uidoc = uiapp?.ActiveUIDocument;\r\n\r\n    try\r\n    {\r\n        // Ebenen sammeln\r\n        var ebenen = new FilteredElementCollector(doc)\r\n                        .OfCategory(BuiltInCategory.OST_Levels)\r\n                        .WhereElementIsNotElementType()\r\n                        .ToElements();\r\n        var ebenenDict = ebenen.ToDictionary(l => l.Name, l => l.Id);\r\n\r\n        var kategorienDict = new Dictionary<string, BuiltInCategory>()\r\n        {\r\n            [\"Wände\"] = BuiltInCategory.OST_Walls,\r\n            [\"Türen\"] = BuiltInCategory.OST_Doors,\r\n            [\"Fenster\"] = BuiltInCategory.OST_Windows,\r\n            [\"Böden\"] = BuiltInCategory.OST_Floors,\r\n            [\"Decken\"] = BuiltInCategory.OST_Ceilings,\r\n            [\"Möbel\"] = BuiltInCategory.OST_Furniture,\r\n            [\"Räume\"] = BuiltInCategory.OST_Rooms,\r\n            [\"Generische Modelle\"] = BuiltInCategory.OST_GenericModel\r\n        };\r\n\r\n        var eingaben = new Dictionary<string, object>();\r\n\r\n        // WinForms-Konfigurationsdialog anzeigen\r\n        using (var form = new NumeratorForm(doc, kategorienDict, ebenenDict))\r\n        {\r\n            var dr = form.ShowDialog();\r\n            if (dr != WF.DialogResult.OK)\r\n            {\r\n                TaskDialog.Show(\"Elemente nummerieren\", \"Vorgang abgebrochen.\");\r\n                return;\r\n            }\r\n            eingaben = form.Eingaben;\r\n        }\r\n\r\n        if (eingaben == null || eingaben.Count == 0)\r\n        {\r\n            TaskDialog.Show(\"Elemente nummerieren\", \"Vorgang abgebrochen.\");\r\n            return;\r\n        }\r\n\r\n        // Konfiguration extrahieren\r\n        eingaben.TryGetValue(\"präfix\", out var iprä); string präfix = iprä as string ?? string.Empty;\r\n        eingaben.TryGetValue(\"nummer\", out var inum);\r\n        string nummerStr = inum as string ?? (inum is int iv ? iv.ToString() : \"0\");\r\n        eingaben.TryGetValue(\"sufix\", out var isuf); string sufix = isuf as string ?? string.Empty;\r\n        eingaben.TryGetValue(\"kategorie\", out var ikat); BuiltInCategory kategorie = ikat is BuiltInCategory bkat ? bkat : default;\r\n        eingaben.TryGetValue(\"parameter\", out var iparam); string parameter = iparam as string;\r\n        eingaben.TryGetValue(\"ebene\", out var iebene); ElementId ebeneId = iebene as ElementId;\r\n        eingaben.TryGetValue(\"sortierung\", out var isort); string sortierung = isort as string;\r\n\r\n        // Elementauswahl\r\n        IList<Reference> refs = null;\r\n        if (sortierung == \"Auswahlreihenfolge (Klick für Klick)\")\r\n        {\r\n            WF.MessageBox.Show(\"Wählen Sie die Elemente einzeln in der gewünschten Reihenfolge aus. ESC zum Beenden.\", \"Auswahlreihenfolge\");\r\n            var tmp = new List<Reference>();\r\n            while (true)\r\n            {\r\n                try\r\n                {\r\n                    var r = uidoc.Selection.PickObject(ObjectType.Element, \"Element auswählen oder ESC zum Beenden\");\r\n                    if (r != null) tmp.Add(r);\r\n                }\r\n                catch (Autodesk.Revit.Exceptions.OperationCanceledException)\r\n                {\r\n                    break;\r\n                }\r\n                catch { break; }\r\n            }\r\n            refs = tmp;\r\n        }\r\n        else\r\n        {\r\n            try\r\n            {\r\n                var picked = uidoc.Selection.PickObjects(ObjectType.Element, \"Wählen Sie die zu nummerierenden Elemente aus\");\r\n                refs = picked;\r\n            }\r\n            catch (Autodesk.Revit.Exceptions.OperationCanceledException)\r\n            {\r\n                TaskDialog.Show(\"Elemente nummerieren\", \"Auswahl abgebrochen.\");\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (refs == null || refs.Count == 0)\r\n        {\r\n            TaskDialog.Show(\"Elemente nummerieren\", \"Keine Elemente ausgewählt.\");\r\n            return;\r\n        }\r\n\r\n        var elemente = refs.Select(r => doc.GetElement(r.ElementId)).ToList();\r\n\r\n        // Nach Kategorie und Ebene filtern\r\n        var gefiltert = new List<Element>();\r\n        if (sortierung == \"Spline (später auswählen)\")\r\n        {\r\n            foreach (var el in elemente)\r\n            {\r\n                if (el == null) continue;\r\n                if (el.Category == null) continue;\r\n                if (el.Category.Id.Value != (int)kategorie) continue;\r\n                gefiltert.Add(el);\r\n            }\r\n        }\r\n        else\r\n        {\r\n            foreach (var el in elemente)\r\n            {\r\n                if (el == null) continue;\r\n                if (el.Category == null) continue;\r\n                if (el.Category.Id.Value != (int)kategorie) continue;\r\n                bool hinzugefügt = false;\r\n                var levelProp = el.GetType().GetProperty(\"LevelId\");\r\n                if (levelProp != null)\r\n                {\r\n                    var val = levelProp.GetValue(el) as ElementId;\r\n                    if (val != null && val == ebeneId)\r\n                    {\r\n                        gefiltert.Add(el);\r\n                        hinzugefügt = true;\r\n                    }\r\n                }\r\n                if (!hinzugefügt)\r\n                {\r\n                    try\r\n                    {\r\n                        var param = el.get_Parameter(Autodesk.Revit.DB.BuiltInParameter.LEVEL_PARAM);\r\n                        if (param != null && param.StorageType == StorageType.ElementId)\r\n                        {\r\n                            var pid = param.AsElementId();\r\n                            if (pid != null && pid == ebeneId)\r\n                            {\r\n                                gefiltert.Add(el);\r\n                                hinzugefügt = true;\r\n                            }\r\n                        }\r\n                    }\r\n                    catch { }\r\n                }\r\n                if (!hinzugefügt)\r\n                {\r\n                    gefiltert.Add(el);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Elemente sortieren\r\n        Curve spline = null;\r\n        ElementId splineId = null;\r\n        if (sortierung == \"Spline (später auswählen)\")\r\n        {\r\n            WF.MessageBox.Show(\"Wählen Sie den zuvor gezeichneten Spline aus.\", \"Spline\");\r\n            Reference splineRef = null;\r\n            try\r\n            {\r\n                splineRef = uidoc.Selection.PickObject(ObjectType.Element, \"Gültigen Spline auswählen\");\r\n            }\r\n            catch (Autodesk.Revit.Exceptions.OperationCanceledException)\r\n            {\r\n                TaskDialog.Show(\"Elemente nummerieren\", \"Spline-Auswahl abgebrochen.\");\r\n                return;\r\n            }\r\n            var splineEl = doc.GetElement(splineRef.ElementId);\r\n            if (!(splineEl is CurveElement) || !((splineEl as CurveElement).GeometryCurve is NurbSpline))\r\n            {\r\n                TaskDialog.Show(\"Elemente nummerieren\", \"Das ausgewählte Element ist kein gültiger Spline.\");\r\n                return;\r\n            }\r\n            spline = (splineEl as CurveElement).GeometryCurve;\r\n            splineId = splineEl.Id;\r\n\r\n            int mitLocation = 0;\r\n            int projiziert = 0;\r\n            var ptsGefiltert = new List<(double param, Element el)>();\r\n            foreach (var el in gefiltert)\r\n            {\r\n                XYZ punkt = null;\r\n                if (el.Location is LocationPoint lp)\r\n                {\r\n                    punkt = lp.Point;\r\n                }\r\n                else if (el.Location is LocationCurve lc && lc.Curve != null)\r\n                {\r\n                    punkt = lc.Curve.Evaluate(0.5, true);\r\n                }\r\n                if (punkt != null)\r\n                {\r\n                    mitLocation++;\r\n                    var proj = spline.Project(punkt);\r\n                    if (proj != null)\r\n                    {\r\n                        ptsGefiltert.Add((proj.Parameter, el));\r\n                        projiziert++;\r\n                    }\r\n                }\r\n            }\r\n            WF.MessageBox.Show($\"Debug Spline: {gefiltert.Count} Elemente nach Kategorie gefiltert, {mitLocation} mit LocationPoint/Curve, {projiziert} auf Spline projiziert.\", \"Debug Spline\");\r\n            ptsGefiltert.Sort((a, b) => a.param.CompareTo(b.param));\r\n            gefiltert = ptsGefiltert.Select(x => x.el).ToList();\r\n        }\r\n        else if (sortierung == \"X-Koordinate\")\r\n        {\r\n            gefiltert.Sort((a, b) =>\r\n            {\r\n                double xa = 0, xb = 0;\r\n                if (a.Location is LocationPoint lpa) xa = lpa.Point.X;\r\n                if (b.Location is LocationPoint lpb) xb = lpb.Point.X;\r\n                return xa.CompareTo(xb);\r\n            });\r\n        }\r\n\r\n        // Konfiguration bestätigen\r\n        string configSummary = $\"Nummerierungs-Konfiguration:\\n\" +\r\n                             $\"• Präfix: '{präfix}'\\n\" +\r\n                             $\"• Startnummer: '{nummerStr}' (Breite: {nummerStr.Length})\\n\" +\r\n                             $\"• Sufix: '{sufix}'\\n\" +\r\n                             $\"• Parameter: {parameter}\\n\" +\r\n                             $\"• Gefilterte Elemente: {gefiltert.Count}\\n\\n\" +\r\n                             $\"Möchten Sie mit der Nummerierung fortfahren?\";\r\n\r\n        var result = WF.MessageBox.Show(configSummary, \"Nummerierung bestätigen\",\r\n            WF.MessageBoxButtons.YesNo, WF.MessageBoxIcon.Question);\r\n\r\n        if (result != WF.DialogResult.Yes)\r\n        {\r\n            return;\r\n        }\r\n\r\n        // Elemente nummerieren\r\n        int padWidth = nummerStr.Length;\r\n        if (padWidth < 1) padWidth = 1;\r\n        if (!int.TryParse(nummerStr, out int basisNummer)) basisNummer = 0;\r\n        var zusammenfassung = new List<string>();\r\n\r\n        for (int i = 0; i < gefiltert.Count; i++)\r\n        {\r\n            var el = gefiltert[i];\r\n            int aktuell = basisNummer + i;\r\n            var nummerTeil = aktuell.ToString().PadLeft(padWidth, '0');\r\n            string wert = string.Format(\"{0}{1}{2}\", präfix, nummerTeil, sufix);\r\n            var param = el.LookupParameter(parameter);\r\n            if (param != null && !param.IsReadOnly)\r\n            {\r\n                try\r\n                {\r\n                    switch (param.StorageType)\r\n                    {\r\n                        case StorageType.String:\r\n                            param.Set(wert);\r\n                            break;\r\n                        case StorageType.Integer:\r\n                            if (int.TryParse(wert, out int intVal))\r\n                            {\r\n                                param.Set(intVal);\r\n                            }\r\n                            else\r\n                            {\r\n                                param.Set(aktuell);\r\n                            }\r\n                            break;\r\n                        case StorageType.Double:\r\n                            if (double.TryParse(wert, out double doubleVal))\r\n                            {\r\n                                param.Set(doubleVal);\r\n                            }\r\n                            else\r\n                            {\r\n                                param.Set((double)aktuell);\r\n                            }\r\n                            break;\r\n                        default:\r\n                            param.Set(wert);\r\n                            break;\r\n                    }\r\n                    zusammenfassung.Add($\"✔ ID {el.Id.Value} → {wert} (Typ: {param.StorageType})\");\r\n                }\r\n                catch (Exception ex)\r\n                {\r\n                    zusammenfassung.Add($\"✘ ID {el.Id.Value} → Fehler: {ex.Message}\");\r\n                }\r\n            }\r\n            else\r\n            {\r\n                string grund = param == null ? \"Parameter nicht gefunden\" : \"Parameter schreibgeschützt\";\r\n                zusammenfassung.Add($\"✘ ID {el.Id.Value} → {grund}\");\r\n            }\r\n        }\r\n        if (splineId != null && splineId != ElementId.InvalidElementId)\r\n        {\r\n            try { doc.Delete(splineId); } catch { }\r\n        }\r\n\r\n        TaskDialog.Show(\"Elemente nummerieren\", $\"Nummerierung auf {gefiltert.Count} Elemente angewendet:\\n\\n{string.Join(\"\\n\", zusammenfassung)}\");\r\n    }\r\n    catch (Exception ex)\r\n    {\r\n        TaskDialog.Show(\"Elemente nummerieren\", \"Fehler: \" + ex.Message);\r\n    }\r\n};\r\n\r\n// Aktion zuweisen\r\nactionProp.SetValue(handlerObj, aktion);\r\n\r\n// Event auslösen (Reflexion)\r\nvar raiseMethod = externalEvent.GetType().GetMethod(\"Raise\");\r\nif (raiseMethod == null) throw new Exception(\"Raise-Methode im externalEvent nicht gefunden.\");\r\nraiseMethod.Invoke(externalEvent, null);\r\n\r\n// Ergebnistext für den Benutzer (deutsch, positiv)\r\nreturn \"Befehl erfolgreich aktiviert.\";\r\n\r\n// --- Interne Klasse NumeratorForm ---\r\npublic class NumeratorForm : WF.Form\r\n{\r\n    public Dictionary<string, object> Eingaben { get; private set; } = new Dictionary<string, object>();\r\n    private WF.TextBox textboxPräfix;\r\n    private WF.TextBox textboxNummer;\r\n    private WF.TextBox textboxSufix;\r\n    private WF.ComboBox comboboxKat;\r\n    private WF.ComboBox comboboxParam;\r\n    private WF.ComboBox comboboxEbene;\r\n    private WF.ComboBox comboboxSort;\r\n\r\n    private Document _doc;\r\n    private Dictionary<string, BuiltInCategory> _kategorienDict;\r\n    private Dictionary<string, ElementId> _ebenenDict;\r\n\r\n    public NumeratorForm(Document doc, Dictionary<string, BuiltInCategory> kategorienDict, Dictionary<string, ElementId> ebenenDict)\r\n    {\r\n        _doc = doc;\r\n        _kategorienDict = kategorienDict;\r\n        _ebenenDict = ebenenDict;\r\n\r\n        this.Text = \"Elemente mit benutzerdefinierter Reihenfolge nummerieren\";\r\n        this.StartPosition = WF.FormStartPosition.CenterScreen;\r\n        this.FormBorderStyle = WF.FormBorderStyle.FixedDialog;\r\n        this.AutoScroll = true;\r\n\r\n        var screen = WF.Screen.FromHandle(this.Handle);\r\n        int screenWidth = screen.Bounds.Width;\r\n        int screenHeight = screen.Bounds.Height;\r\n\r\n        int baseWidth = Math.Min(620, (int)(screenWidth * 0.4));\r\n        int padding = Math.Max(15, baseWidth / 30);\r\n\r\n        this.Padding = new WF.Padding(padding, padding, padding, padding);\r\n\r\n        int y = padding;\r\n        int labelHeight = Math.Max(20, baseWidth / 25);\r\n        int controlHeight = Math.Max(20, baseWidth / 28);\r\n        int spacing = Math.Max(25, baseWidth / 20);\r\n        int leftMargin = padding;\r\n        int controlWidth = baseWidth - (padding * 2);\r\n\r\n        void add_label(string text)\r\n        {\r\n            var lbl = new WF.Label();\r\n            lbl.Text = text;\r\n            lbl.Top = y;\r\n            lbl.Left = leftMargin;\r\n            lbl.Width = controlWidth;\r\n            lbl.Height = labelHeight;\r\n            lbl.TextAlign = System.Drawing.ContentAlignment.MiddleLeft;\r\n            this.Controls.Add(lbl);\r\n            y += labelHeight + 5;\r\n        }\r\n\r\n        void add_textbox(out WF.TextBox tb)\r\n        {\r\n            tb = new WF.TextBox();\r\n            tb.Top = y;\r\n            tb.Left = leftMargin;\r\n            tb.Width = controlWidth;\r\n            tb.Height = controlHeight;\r\n            this.Controls.Add(tb);\r\n            y += controlHeight + spacing;\r\n        }\r\n\r\n        void add_combobox(out WF.ComboBox cb)\r\n        {\r\n            cb = new WF.ComboBox();\r\n            cb.Top = y;\r\n            cb.Left = leftMargin;\r\n            cb.Width = controlWidth;\r\n            cb.Height = controlHeight;\r\n            cb.DropDownStyle = WF.ComboBoxStyle.DropDownList;\r\n            this.Controls.Add(cb);\r\n            y += controlHeight + spacing;\r\n        }\r\n        add_label(\"Präfix:\");\r\n        add_textbox(out textboxPräfix);\r\n\r\n        add_label(\"Startnummer:\");\r\n        add_textbox(out textboxNummer);\r\n        textboxNummer.Text = \"1\";\r\n\r\n        add_label(\"Sufix:\");\r\n        add_textbox(out textboxSufix);\r\n\r\n        add_label(\"Kategorie:\");\r\n        add_combobox(out comboboxKat);\r\n        comboboxKat.Items.AddRange(_kategorienDict.Keys.ToArray());\r\n        comboboxKat.SelectedIndex = 0;\r\n        comboboxKat.SelectedIndexChanged += ComboboxKat_SelectedIndexChanged;\r\n\r\n        add_label(\"Zu nummerierender Parameter:\");\r\n        add_combobox(out comboboxParam);\r\n\r\n        add_label(\"Ebene:\");\r\n        add_combobox(out comboboxEbene);\r\n        comboboxEbene.Items.AddRange(_ebenenDict.Keys.ToArray());\r\n        comboboxEbene.SelectedIndex = 0;\r\n\r\n        add_label(\"Sortieren nach:\");\r\n        add_combobox(out comboboxSort);\r\n        comboboxSort.Items.AddRange(new string[] { \"X-Koordinate\", \"Spline (später auswählen)\", \"Auswahlreihenfolge (Klick für Klick)\" });\r\n        comboboxSort.SelectedIndex = 0;\r\n\r\n        y += spacing;\r\n\r\n        var buttonWidth = Math.Max(120, controlWidth / 3);\r\n        var buttonHeight = Math.Max(28, controlHeight + 8);\r\n\r\n        var button = new WF.Button();\r\n        button.Text = \"Weiter\";\r\n        button.Top = y;\r\n        button.Left = leftMargin;\r\n        button.Width = buttonWidth;\r\n        button.Height = buttonHeight;\r\n        button.Click += Button_Click;\r\n        this.Controls.Add(button);\r\n\r\n        var buttonCancel = new WF.Button();\r\n        buttonCancel.Text = \"Abbrechen\";\r\n        buttonCancel.Top = y;\r\n        buttonCancel.Left = leftMargin + buttonWidth + 20;\r\n        buttonCancel.Width = buttonWidth;\r\n        buttonCancel.Height = buttonHeight;\r\n        buttonCancel.Click += (s, e) => { this.DialogResult = WF.DialogResult.Cancel; this.Close(); };\r\n        this.Controls.Add(buttonCancel);\r\n\r\n        int buttonsHeight = buttonHeight + (spacing * 2);\r\n        int maxContentHeight = Math.Min(screenHeight - 200, 700);\r\n        int totalContentHeight = y - padding;\r\n\r\n        int formHeight;\r\n        if (totalContentHeight <= maxContentHeight)\r\n        {\r\n            formHeight = totalContentHeight + buttonsHeight + padding;\r\n        }\r\n        else\r\n        {\r\n            formHeight = maxContentHeight + buttonsHeight + padding;\r\n        }\r\n\r\n        int totalWidth = baseWidth + 40;\r\n\r\n        this.ClientSize = new System.Drawing.Size(totalWidth, formHeight);\r\n        this.MaximizeBox = false;\r\n        this.MinimizeBox = false;\r\n\r\n        UpdateParameters();\r\n    }\r\n\r\n    private void ComboboxKat_SelectedIndexChanged(object sender, EventArgs e)\r\n    {\r\n        UpdateParameters();\r\n    }\r\n\r\n    private void UpdateParameters()\r\n    {\r\n        comboboxParam.Items.Clear();\r\n        var kategorieName = comboboxKat.SelectedItem as string;\r\n        if (string.IsNullOrEmpty(kategorieName)) return;\r\n        if (!_kategorienDict.TryGetValue(kategorieName, out var bic)) return;\r\n        var elems = new FilteredElementCollector(_doc).OfCategory(bic).WhereElementIsNotElementType().ToElements();\r\n        var namen = new HashSet<string>();\r\n        foreach (var el in elems)\r\n        {\r\n            foreach (Parameter p in el.Parameters)\r\n            {\r\n                try { if (!p.IsReadOnly) namen.Add(p.Definition.Name); } catch { }\r\n            }\r\n        }\r\n        foreach (var n in namen.OrderBy(x => x)) comboboxParam.Items.Add(n);\r\n        if (comboboxParam.Items.Count > 0) comboboxParam.SelectedIndex = 0;\r\n    }\r\n\r\n    private void Button_Click(object sender, EventArgs e)\r\n    {\r\n        try\r\n        {\r\n            var nummerText = textboxNummer.Text ?? \"\";\r\n            if (string.IsNullOrWhiteSpace(nummerText)) nummerText = \"0\";\r\n            if (!System.Text.RegularExpressions.Regex.IsMatch(nummerText, \"^\\\\d+$\")) throw new Exception(\"Die Startnummer darf nur Ziffern enthalten.\");\r\n\r\n            Eingaben[\"präfix\"] = textboxPräfix.Text;\r\n            Eingaben[\"nummer\"] = nummerText;\r\n            Eingaben[\"sufix\"] = textboxSufix.Text;\r\n            Eingaben[\"kategorie\"] = _kategorienDict[comboboxKat.SelectedItem as string];\r\n            Eingaben[\"parameter\"] = comboboxParam.SelectedItem as string;\r\n            Eingaben[\"ebene\"] = _ebenenDict[comboboxEbene.SelectedItem as string];\r\n            Eingaben[\"sortierung\"] = comboboxSort.SelectedItem as string;\r\n            this.DialogResult = WF.DialogResult.OK;\r\n            this.Close();\r\n        }\r\n        catch (Exception ex)\r\n        {\r\n            WF.MessageBox.Show(\"Fehler in den Feldern: \" + ex.Message);\r\n        }\r\n    }\r\n}",
      "IsFavorite": false,
      "ShowAsButton": true,
      "CreatedDate": "2025-10-18T16:44:49.559956-05:00",
      "LastModified": "2025-10-18T16:44:49.5599561-05:00"
    }
  ]
}